define(["cBase","cStorage","libs","CommonStore","cModel"],function(a,b,c,d,e){function f(a){var b=".__hreftel__",c=".__conttel__",d=".__appaddress__";$(a[0]).find(b).each(function(){this.href=w(this.href)}),$(a[0]).find(c).each(function(){var a=$(this);a.html(w(a.html()))}),$(d).each(function(){var a=x();if(!a)switch(!0){case t:a=$(this).attr("data-ios-app");break;case u:a=$(this).attr("data-android-app");break;case v:a=$(this).attr("data-win-app")}a&&$(this).attr("href",a)})}function g(a){var c=a.$el;a.getQuery||(a.getQuery=Lizard.P);var e=location.host,g=document.referrer,h="";e&&-1===g.indexOf(e)&&(g=g.replace("http://","").replace("https://","").split("/")[0].toLowerCase(),g.indexOf("baidu")>-1&&(h="SEO_BAIDU"),g.indexOf("google")>-1&&(h="SEO_GOOGLE"),g.indexOf("soso.com")>-1&&(h="SEO_SOSO"),g.indexOf("sogou")>-1&&(h="SEO_SOGOU"),g.indexOf("so.com")>-1&&(h="SEO_SO"),g.indexOf("so.360")>-1&&(h="SEO_360SO"),g.indexOf("bing.com")>-1&&(h="SEO_BING"),g.indexOf("yahoo")>-1&&(h="SEO_YAHOO"),(g.indexOf("youdao")>-1||g.indexOf("sm.cn")>-1)&&(h="SEO_YOUDAO"),(g.indexOf("jike.com")>-1||g.indexOf("babylon.com")>-1||g.indexOf("ask.com")>-1||g.indexOf("avg.com")>-1||g.indexOf("easou.com")>-1||g.indexOf("panguso.com")>-1||g.indexOf("yandex.com")>-1)&&(h="SEO_360SO"));var i=window.localStorage.getItem("SOURCEID"),j=a.getQuery("sourceid"),l=a.getQuery("sales"),o=d.SalesStore.getInstance().get(),p=a.getQuery("sales")||h||o&&o.sales,q=a.getQuery("sourceid")||i||o&&o.sourceid;(j&&+j>0||l&&l.length>0)&&b.localStorage.oldRemove("APP_DOWNLOAD"),p||q?(p&&m(p),q&&n(q),k(p||q,$.proxy(function(b){if((!b.appurl||b.appurl.length<=0)&&a.footer&&a.footer.rootBox){var d=a.footer.rootBox.find("#dl_app");d.length>0&&d.hide()}a.warning404.tel=b.tel?b.tel:"4000086666",f(c)},a))):e&&-1===g.indexOf(e)&&(g=g.replace("http://","").replace("https://","").split("/")[0].toLowerCase(),g.indexOf("baidu")>-1&&(p="SEO_BAIDU"),g.indexOf("google")>-1&&(p="SEO_GOOGLE"),g.indexOf("soso.com")>-1&&(p="SEO_SOSO"),g.indexOf("sogou")>-1&&(p="SEO_SOGOU"),g.indexOf("so.com")>-1&&(p="SEO_SO"),g.indexOf("so.360")>-1&&(p="SEO_360SO"),g.indexOf("bing.com")>-1&&(p="SEO_BING"),g.indexOf("yahoo")>-1&&(p="SEO_YAHOO"),(g.indexOf("youdao")>-1||g.indexOf("sm.cn")>-1)&&(p="SEO_YOUDAO"),(g.indexOf("jike.com")>-1||g.indexOf("babylon.com")>-1||g.indexOf("ask.com")>-1||g.indexOf("avg.com")>-1||g.indexOf("easou.com")>-1||g.indexOf("panguso.com")>-1||g.indexOf("yandex.com")>-1)&&(p="SEO_360SO"),p&&m(p),setTimeout(function(){f(c)},1))}var h=null,i=d.SalesObjectStore.getInstance(),j=function(a){return e.baseurl(a)},k=function(c,d,e){var f=i.get(c);if(f)h=f,!f.appurl||f.appurl.length<=0?$("#dl_app").hide():$("#dl_app").show(),d&&d(f);else{var g=j(),k="http://"+(g&&g.domain)+"/html5/ClientData/GetSalesInfo/"+c;$.ajax({url:k,type:"POST",dataType:"json",success:$.proxy(function(f){var g={};if(1==f.ServerCode){if(f.Data){for(var j in f.Data)g[j.toLowerCase()]=f.Data[j];f.Data=g,i.set(f.Data,c);var k=30;!f.Data||"ydwxcs"!==f.Data.sales&&"1622"!==f.Data.sales||(k=5),!f.Data.appurl||f.Data.appurl.length<=0?$("#dl_app").hide():$("#dl_app").show(),b.localStorage.oldSet("SALESOBJ",JSON.stringify({data:f.Data,timeout:new a.Date(a.getServerDate()).addDay(k).format("Y/m/d H:i:s")}))}h=f.Data,d&&d(f.Data)}else e&&e(f)},this),error:$.proxy(function(a){e&&e(a)},this)})}},l=function(){return h},m=function(a){d.SalesStore.getInstance().set({sales:a})},n=function(a){d.SalesStore.getInstance().set({sourceid:a})},o=function(a){d.UnionStore.getInstance().set(a)},p=/400\d{3}\d{4}/i,q=/400\s+\d{3}\s+\d{4}/i,r=/400-\d{3}-\d{4}/i,s=navigator.userAgent,t=!!s.match(/(ipad|iphone)/i),u=!!s.match(/android/i),v=!!s.match(/MSIE/i),w=window.replaceStrTel=function(a){var b=l();return"string"==typeof a&&b&&b.tel&&(a=a.replace(p,b.tel),a=a.replace(q,b.teltitle),b.teltitle&&(a=a.replace(r,b.teltitle.split(" ").join("-")))),a},x=function(a){var b=l();if(b){if(b.isseo&&$(".module").show(),b.appurl)return b.appurl;var a=b.sid?b.sid:b.sales;return"/market/download.aspx?from="+a}return null};return{replaceContent:f,replaceStrTel:w,setSales:m,getSales:l,getSalesObject:k,setUnion:o,setSourceId:n,updateSales:g}});