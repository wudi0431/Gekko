define(["cBase","cUIAbstractView"],function(a,b){var c={};return c.__propertys__=function(){this.data=[],this.needFold=!1,this.foldAll=!1,this.unFoldOne=!1,this.selectedKey=null,this.el=null,this.filter="",this.click=function(){},this.OnClick=function(){},this.isCreated=!1,this.itemTemplate=!1},c.initialize=function($super,a){for(var b in a)this[b]=a[b];$super(a),this.paramFormat(),this.bindEvent(),this.show()},c.paramFormat=function(){var a=this.filter&&this.filter.split(",");"object"!=typeof a&&(a={}),this.filter=a},c.bindEvent=function(){this.addEvent("onShow",function(){if(!this.isCreated){this.isCreated=!0;this.init(),this.root.on("click",$.proxy(function(a){for(var b=$(a.target),c=!1;;){if(b.attr("id")==this.id)break;if("c"==b.attr("data-flag")){c=!0;break}b=b.parent()}if(c)return void this.setSelected(b.attr("data-key"));if(0!=this.needFold&&b.hasClass("cui-city-t")){var d=b.parent();d.hasClass("cui-arrow-close")?(this.unFoldOne&&this.root.find(".cui-city-itmes > li").attr("class","cui-arrow-close"),d.attr("class","cui-arrow-open")):(this.unFoldOne&&this.root.find(".cui-city-itmes > li").attr("class","cui-arrow-close"),d.attr("class","cui-arrow-close"))}},this))}})},c.destroy=function(){this.root.off("click"),this.root.remove()},c.init=function(){1==this.foldAll&&(this.needFold=!0),this.tmpt=_.template(['<ul class="cui-city-itmes">',"<%for(var i = 0, len = data.length; i < len; i++) { %>",'<li data-groupindex="<%=i%>" data-key="<%=data[i].id %>"  '+(this.needFold?'<%if(foldAll && ((typeof data[i].unFold == "undefined") || data[i].unFold != true)) {%> class="cui-arrow-close" <%} else {%> class="cui-arrow-open" <%}%>':"")+">",'<span class="cui-city-t" ><%=data[i].name %></span>',"<%var item = data[i].data; %>",'<ul class="cui-city-n">',"<%for(var j = 0, len1 = item.length; j < len1; j++) { %>","<% var itemData = item[j]; %>",'<% var _f = ""; for(var k in filter) { _f += (itemData[filter[k]] ? itemData[filter[k]] : "").toLowerCase() + " ";  } %>','<li data-skey="item_<%=itemData.id%>" '+("undefined"!=typeof this.groupFlag?'data-groupflag="'+this.groupFlag+'"':"")+' data-filter="<%=_f%>" data-key="<%=itemData.id%>" data-index="<%=i%>,<%=j%>" data-flag="c" <%if(itemData.id == selectedKey){%> class="current" <%}%> > '+(this.itemTemplate?this.itemTemplate:"<%=itemData.name %>")+" </li>","<%} %>","</ul>","</li>","<%} %>","</ul>"].join(""));var a=this.tmpt({data:this.data,foldAll:this.foldAll,selectedKey:this.selectedKey,filter:this.filter});this.root.html(a)},c.updateItem=function(){},c.updateGroup=function(a,b){var c=this.data[a];if(c){this.data[a]=b;var d=this.root.find('li[data-groupindex="'+a+'"]');this.tmpt=_.template(['<li data-groupindex="<%=i%>" data-key="<%=data.id %>"  '+(this.needFold?'<%if(foldAll && ((typeof data.unFold == "undefined") || data.unFold != true)) {%> class="cui-arrow-close" <%} else {%> class="cui-arrow-open" <%}%>':"")+">",'<span class="cui-city-t" ><%=data.name %></span>',"<%var item = data.data; %>",'<ul class="cui-city-n">',"<%for(var j = 0, len1 = item.length; j < len1; j++) { %>",'<% var _f = ""; for(var k in filter) { _f += (item[j][filter[k]] ? item[j][filter[k]] : "").toLowerCase() + " ";  } %>','<li data-skey="item_<%=item[j].id%>" '+("undefined"!=typeof this.groupFlag?'data-groupflag="'+this.groupFlag+'"':"")+' data-filter="<%=_f%>" data-key="<%=item[j].id%>" data-index="<%=i%>,<%=j%>" data-flag="c" <%if(item[j].id == selectedKey){%> class="current" <%}%> ><%=item[j].name %></li>',"<%} %>","</ul>","</li>"].join(""));var e=this.tmpt({data:b,foldAll:this.foldAll,selectedKey:this.selectedKey,filter:this.filter,i:a}),f=$(e);d.before(f),d.remove()}},c.reload=function(a){a&&(this.data=a),this.root.html(""),this.init()},c.setSelected=function(a,b){this.selectedKey=a;var c=this.getSelected();this.root.find(".cui-city-n li").removeClass("current"),this.el.addClass("current"),"function"==typeof this.onClick&&this.onClick.call(this,c),"function"!=typeof this.click||b||this.click.call(this,c)},c.getSelected=function(){if(this.el=this.root.find('li[data-skey="item_'+(this.selectedKey||"")+'"]'),"string"!=typeof this.el.attr("data-index"))return null;var a=this.el.attr("data-index").split(",");return 2!=a.length?null:this.data[parseInt(a[0])].data[parseInt(a[1])]},c.createHtml=function(){return""},new a.Class(b,c)});