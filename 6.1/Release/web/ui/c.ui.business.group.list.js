define(["cBase","cUIAbstractView","cUIGroupList"],function(a,b,c){var d={};return d.__propertys__=function(){this.needTab=!0,this.groupIndex=0,this.groupObj=[],this.isCreated=!1,this.selectedKey=null,this.CLICK_RES=null,this.filter="",this.needFold=!1,this.foldAll=!1,this.unFoldOne=!1,this.showFnBtn=!1,this.fnBtnTxt="清除历史记录",this.fnBtnCallback=function(){},this.itemTemplate=!1,this.isAjax=!1,this.ajaxCallBack=function(){},this.lastKeyword="",this.ajaxData=[]},d.initialize=function($super,a){for(var b in a)this[b]=a[b];$super(a),this.isAjax&&(this.needFold=!1,this.foldAll=!1,this.filter="",this.needTab=!1),this.bindEvent(),this.show()},d.bindEvent=function(){this.addEvent("onHide",function(){this.destroyItemInstance(),this.unBindTabEvent(),this.unBindSeachEvent(),this.unBindSeachItemEvent(),this.unBindCancelEvent(),this.unBindFnBtn(),this.root.remove()}),this.addEvent("onShow",function(){if(!this.isCreated){this.isCreated=!0;this.init(),this.bindTabEvent(),this.bindSeachEvent(),this.bindSeachItemEvent(),this.bindCancelEvent(),this.bindFnBtn()}})},d.bindFnBtn=function(){this.showFnBtn&&this.root.find(".cui-btn-history").on("click",$.proxy(function(){this.fnBtnCallback.call(this)},this))},d.unBindFnBtn=function(){this.showFnBtn&&this.root.find(".cui-btn-history").off("click")},d.destroyItemInstance=function(){for(var a=0,b=this.groupObj.length;b>a;a++)this.groupObj[a].instance.destroy()},d.unBindTabEvent=function(){var a=this.tabWrapper.find("li");a.off("click")},d.bindTabEvent=function(){var a=this.tabWrapper.find("li");a.on("click",$.proxy(function(b){var c=$(b.target);a.removeClass("cui-tab-current"),c.addClass("cui-tab-current");var d=c.attr("data-index");this.groupObj[this.groupIndex].instance.hide(),this.groupObj[this.groupIndex].instance.selectedKey&&(this.selectedKey=this.groupObj[this.groupIndex].instance.selectedKey),this.selectedKey&&this.groupObj[d].instance.setSelected(this.selectedKey,!0),this.groupObj[d].instance.show(),this.groupIndex=d},this))},d.getSelected=function(){return this.selectedKey},d.unBindSeachEvent=function(){this.searchBox.off("focus")},d.bindSeachEvent=function(){this.searchBox.on("focus",$.proxy(function(){this.openSeach()},this))},d.unBindSeachItemEvent=function(){this.seachList.off("click")},d.bindSeachItemEvent=function(){this.seachList.on("click",$.proxy(function(a){for(var b=$(a.target),c=!1;;){if(b.hasClass("seach-list"))break;if("c"==b.attr("data-flag")){c=!0;break}b=b.parent()}return this.isAjax?void("function"==typeof this.click&&(this.click.call(this,this.ajaxData[b.attr("data-index")]),this.closeSeach())):(this.groupIndex=b.attr("data-groupflag"),this.selectedKey=b.attr("data-key"),this.groupObj[this.groupIndex].instance.setSelected(this.selectedKey),void this.closeSeach())},this))},d.unBindCancelEvent=function(){this.cancel.off("click")},d.bindCancelEvent=function(){this.cancel.on("click",$.proxy(function(){this.closeSeach()},this))},d.openSeach=function(){this.CLICK_RES||(this.CLICK_RES=setInterval($.proxy(function(){("INPUT"!=document.activeElement.nodeName||"text"!=document.activeElement.type)&&this.CLICK_RES&&(clearInterval(this.CLICK_RES),this.CLICK_RES=null);var a=this.searchBox.val().toLowerCase();if(""==a)return void setTimeout($.proxy(function(){("INPUT"!=document.activeElement.nodeName||"text"!=document.activeElement.type)&&this.closeSeach()},this),500);if(this.lastKeyword==a)return!0;if(this.lastKeyword=a,this.wrapper.addClass("cui-input-focus"),this.root.find(".cui-btn-history").hide(),this.listWrapper.hide(),this.tabWrapper.hide(),this.seachList.show(),this.seachList.html(""),this.noData.hide(),this.isAjax)return this.ajaxCallBack.call(this,a),void(this.LOADINGSRC=setTimeout($.proxy(function(){this.loading.show()},this),200));for(var b=this.listWrapper.find('li[data-filter*="'+a+'"]'),c=[],d=0,e=b.length;e>d;d++){var f=!1;for(var g in c)if($(c[g]).attr("data-key")==$(b[d]).attr("data-key")){f=!0;break}0==f&&c.push(b[d])}return 0==c.length?void this.noData.show():void this.seachList.append($(c).clone(!0))},this),500))},d.ajaxDataHandle=function(a){this.ajaxData=a;var b=["<% for(var i = 0, len = data.length; i < len; i++ ){ %>","<% itemData = data[i]; %>",'<li data-key="<%=itemData.id%>" data-index="<%=i%>" data-flag="c" '+(this.itemTemplate?this.itemTemplate:"<%=itemData.name %>")+" </li>","<% } %>"].join(""),c=_.template(b)({data:a});this.LOADINGSRC&&clearTimeout(this.LOADINGSRC),this.loading.hide(),this.seachList.html(c)},d.closeSeach=function(){this.CLICK_RES&&(clearInterval(this.CLICK_RES),this.CLICK_RES=null),this.wrapper.removeClass("cui-input-focus"),this.noData.hide(),this.searchBox.val(""),this.needTab&&this.tabWrapper.show(),this.seachList.hide(),this.listWrapper.show(),this.lastKeyword="",this.root.find(".cui-btn-history").show()},d.init=function(){this.tabWrapper=this.root.find(".cui-tab-mod"),this.tabBar=this.tabWrapper.find(".cui-tab-scrollbar"),this.noData=this.root.find(".cui-city-novalue"),this.wrapper=this.root.find(".cui-citys-hd"),this.listWrapper=this.root.find(".cui-citys-bd"),this.searchBox=this.root.find(".cui-input-box"),this.seachList=this.root.find(".seach-list"),this.cancel=this.root.find(".cui-btn-cancle"),this.loading=this.root.find(".cui-pro-load"),this.initTab(),this.initGroupList(),this.bindEvent()},d.initTab=function(){for(var a=0,b=this.groupObj.length;b>a;a++){var c='<li data-index="'+a+'" '+(a==this.groupIndex?'class="cui-tab-current"':"")+" >"+this.groupObj[a].name+"</li>";this.tabBar.before(c)}},d.initGroupList=function(){for(var a=this,b=0,d=this.groupObj.length;d>b;b++){var e=this.groupObj[b].data;this.groupObj[b].instance=new c({rootBox:this.listWrapper,data:e,filter:this.filter,click:this.click,foldAll:this.foldAll,needFold:this.needFold,itemTemplate:this.itemTemplate,unFoldOne:this.unFoldOne,groupFlag:b,onClick:function(){a.selectedKey=this.selectedKey}}),this.groupObj[b].instance.hide()}this.groupObj[this.groupIndex].instance.show(),this.groupObj[this.groupIndex].instance.setSelected(this.selectedKey,!0)},d.reload=function(a){a&&(this.groupObj=a),this.destroyItemInstance(),this.listWrapper.empty(),this.initGroupList()},d.updateTab=function(){},d.updateTabGroup=function(){},d.updateAllTabGroup=function(a,b){for(var c=0,d=this.groupObj.length;d>c;c++)this.groupObj[c].instance.updateGroup(a,b)},d.updateTabGroupItem=function(){},d.createHtml=function(){return['<section class="cui-citys-hd ">','<div class="cui-input-bd">','<input type="text" class="cui-input-box" placeholder="中文/拼音/首字母">','<span class="cui-pro-load" style="display: none;">','<span class="cui-pro-radius"></span>','<span class="cui-i cui-pro-logo"></span>',"</span>","</div>",'<button type="button" class="cui-btn-cancle">',"取消</button>","</section>",'<p class="cui-city-novalue" style="display: none;">没有结果</p>','<ul class="cui-tab-mod" '+(this.needTab?"":'style="display: none"')+" >",'<i class="cui-tab-scrollbar cui-tabnum'+this.groupObj.length+'"></i>',"</ul>",'<ul class="cui-city-associate seach-list"></ul>','<section  class="cui-citys-bd">',"</section>",this.showFnBtn?'<button type="button" class="cui-btn-history" >'+this.fnBtnTxt+"</button>":""].join("")},new a.Class(b,d)});