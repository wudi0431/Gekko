define(["cWidgetFactory","cWidgetGeolocation","cWidgetGuider"],function(a){var b={},c=a.create("Geolocation"),d=a.create("Guider"),e=c.PositionStore.getInstance();return b.GeoLocation=function(){function a(a,b,c){for(var d in i)i[d]&&"function"==typeof i[d][a]&&i[d][a].apply(i[d].scope,b);c&&(i={})}var b=0,f=1,g=2,h=3,i={},j=b,k=null;return{Subscribe:function(b,l,m,n){l=l||{},i[b]||(i[b]={name:b,onStart:l.onStart,onComplete:l.onComplete,onError:l.onError,onPosComplete:l.onPosComplete,onPosError:l.onPosError,scope:m});var o=e.get();if(n&&(o=null),o)j=f,a("onStart",null),j=g,a("onPosComplete",[o.lng,o.lat]),a("onComplete",[o],!0);else{if(clearTimeout(k),k=setTimeout(function(){j===f&&(j=h,d.print({log:"#cGeoService -- 22 second timeout call onError"}),a("onError",[null],!0))},35e3),j===f)return void(i[b]&&"function"==typeof i[b].onStart&&i[b].onStart.call(m));j=f,a("onStart",null),d.print({log:"#cGeoService -- start request city info"}),c.requestCityInfo(function(b){j=g,e.set(b),a("onComplete",[b],!0)},function(b,c){j=h,"number"==typeof c&&2===c&&(c={code:1}),d.print({log:"#cGeoService -- locate onError"}),a("onError",[b,c],!0)},function(b,c){a("onPosComplete",[b,c])},function(b,c){j=h,"number"==typeof c&&2===c&&(c={code:1}),a("onPosError",[b,c],!0)},!0)}},UnSubscribe:function(a){a=_.isArray(a)?a:[a];for(var b=0;b<a.length;b++)delete i[a[b]]},ClearPosition:function(){e.remove()}}}(),b.GeoAround=function(){return{Subscribe:function(a,b,d,e){c.requestAroundInfo(a,function(a){b.call(e,a)},function(){d.call(e)})}}}(),b.GeoKeyword=function(){return{Subscribe:function(a,b,d,e,f){c.requestKeywordInfo(a,b,function(a){d.call(f,a)},function(){e.call(f)})}}}(),b});