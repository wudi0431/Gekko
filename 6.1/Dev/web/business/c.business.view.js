define(["cBase","cUIView","CommonStore","cSales","cUtility","cStorage"],function(a,b,c,d,e,f){var g={getGuid:function(){return e.getGuid()},sendGa:function(){if("undefined"!=typeof _gaq){var a=this._getAurl();_gaq.push(["_trackPageview",a])}else setTimeout($.proxy(this.sendGa,this),300)},sendKenshoo:function(){var a=this.request.query;if(a&&a.orderid){var b="https://2113.xg4ken.com/media/redir.php?track=1&token=8515ce29-9946-4d41-9edc-2907d0a92490&promoCode=&valueCurrency=CNY&GCID=&kw=&product=";b+="&val="+a.val+"&orderId="+a.orderid+"&type="+a.type;var c="<img width='1' height='1' src='"+b+"'/>";$("body").append(c)}},sendMarin:function(){var a=this.request.query;if(a&&a.orderid){var b="https://tracker.marinsm.com/tp?act=2&cid=6484iki26001&script=no";b+="&price="+a.val+"&orderid="+a.orderid+"&convtype="+a.type;var c="<img width='1' height='1' src='"+b+"'/>";$("body").append(c)}},disposeChannel:function(){var a,b=this.getQuery("allianceid"),d=this.getQuery("sid"),e=this.getQuery("ouid");if(b&&d)a={AllianceID:b,SID:d,OUID:e},c.UnionStore.getInstance().set(a);else{var f=location.host,g=document.referrer;f&&-1===g.indexOf(f)&&(g=g.replace("http://","").replace("https://","").split("/")[0].toLowerCase(),g.indexOf("baidu")>-1&&(b=b||"4897",d=d||"353693",e=e||""),g.indexOf("google")>-1&&(b=b||"4899",d=d||"353694",e=e||""),g.indexOf("soso.com")>-1&&(b=b||"4900",d=d||"353696",e=e||""),g.indexOf("sogou")>-1&&(b=b||"4901",d=d||"353698",e=e||""),g.indexOf("m.so.com")>-1&&(b=b||"5376",d=d||"353699",e=e||""),g.indexOf("so.360")>-1&&(b=b||"5376",d=d||"353700",e=e||""),g.indexOf("bing.com")>-1&&(b=b||"4902",d=d||"353701",e=e||""),g.indexOf("yahoo")>-1&&(b=b||"4903",d=d||"353703",e=e||""),g.indexOf("youdao")>-1&&(b=b||"4904",d=d||"353704",e=e||""),(g.indexOf("jike.com")>-1||g.indexOf("babylon.com")>-1||g.indexOf("ask.com")>-1||g.indexOf("avg.com")>-1||g.indexOf("easou.com")>-1||g.indexOf("panguso.com")>-1||g.indexOf("yandex.com")>-1)&&(b=b||"5376",d=d||"353700",e=e||""),b&&d&&(a={AllianceID:b,SID:d,OUID:e},c.UnionStore.getInstance().set(a)))}},updateSales:function(a){var b=location.host,e=document.referrer,g="";b&&-1===e.indexOf(b)&&(e=e.replace("http://","").replace("https://","").split("/")[0].toLowerCase(),e.indexOf("baidu")>-1&&(g="SEO_BAIDU"),e.indexOf("google")>-1&&(g="SEO_GOOGLE"),e.indexOf("soso.com")>-1&&(g="SEO_SOSO"),e.indexOf("sogou")>-1&&(g="SEO_SOGOU"),e.indexOf("m.so.com")>-1&&(g="SEO_SO"),e.indexOf("so.360")>-1&&(g="SEO_360SO"),e.indexOf("bing.com")>-1&&(g="SEO_BING"),e.indexOf("yahoo")>-1&&(g="SEO_YAHOO"),e.indexOf("youdao")>-1&&(g="SEO_YOUDAO"),(e.indexOf("jike.com")>-1||e.indexOf("babylon.com")>-1||e.indexOf("ask.com")>-1||e.indexOf("avg.com")>-1||e.indexOf("easou.com")>-1||e.indexOf("panguso.com")>-1||e.indexOf("yandex.com")>-1)&&(g="SEO_360SO"));var h=window.localStorage.getItem("SOURCEID"),i=this.getQuery("sourceid"),j=this.getQuery("sales"),k=c.SalesStore.getInstance().get(),l=this.getQuery("sales")||g||k&&k.sales,m=this.getQuery("sourceid")||h||k&&k.sourceid;(i&&+i>0||j&&j.length>0)&&f.localStorage.oldRemove("APP_DOWNLOAD"),l||m?(l&&d.setSales(l),m&&d.setSourceId(m),d.getSalesObject(l||m,$.proxy(function(b){this.warning404.tel=b.tel?b.tel:"4000086666",d.replaceContent(a)},this))):b&&-1===e.indexOf(b)&&(e=e.replace("http://","").replace("https://","").split("/")[0].toLowerCase(),e.indexOf("baidu")>-1&&(l="SEO_BAIDU"),e.indexOf("google")>-1&&(l="SEO_GOOGLE"),e.indexOf("soso.com")>-1&&(l="SEO_SOSO"),e.indexOf("sogou")>-1&&(l="SEO_SOGOU"),e.indexOf("m.so.com")>-1&&(l="SEO_SO"),e.indexOf("so.360")>-1&&(l="SEO_360SO"),e.indexOf("bing.com")>-1&&(l="SEO_BING"),e.indexOf("yahoo")>-1&&(l="SEO_YAHOO"),e.indexOf("youdao")>-1&&(l="SEO_YOUDAO"),(e.indexOf("jike.com")>-1||e.indexOf("babylon.com")>-1||e.indexOf("ask.com")>-1||e.indexOf("avg.com")>-1||e.indexOf("easou.com")>-1||e.indexOf("panguso.com")>-1||e.indexOf("yandex.com")>-1)&&(g="SEO_360SO"),l&&d.setSales(l),setTimeout(function(){d.replaceContent(a)},1))},_sendUbt:function(){if(window.$_bf&&1==window.$_bf.loaded){var a=location.href,b=this.request.query,c=$("#page_id"),d=$("#bf_ubt_orderid"),f=+this.pageid;e.isInApp()&&(f+=1e3,a="http://hybridm.ctrip.com/"+location.pathname+location.hash),1==c.length&&c.val(f),1==d.length&&d.val(b&&b.orderid?b.orderid:""),window.$_bf.asynRefresh({page_id:f,url:a})}else setTimeout($.proxy(this._sendUbt,this),300)},onShowFinish:function(){this._sendUbt(),this.updateSales(this.$el),this.onBottomPull&&(this._onWidnowScroll=$.proxy(this.onWidnowScroll,this),this.addScrollListener()),this.sendGa(),this.sendKenshoo(),this.sendMarin()},_getDefaultHeader:function(){return{backUrl:null,home:!1,phone:null,title:null,subtitle:null,rightAction:null}},_getAurl:function(){var a,b=this.request.root;return this.request.viewpath&&(b+="#"+this.request.viewpath),this.request.path.length>0&&(a=$.param(this.request.query),b+="!"+this.request.path.join("/")+(a.length?"?"+a:"")),b}};return b.extend(g)});